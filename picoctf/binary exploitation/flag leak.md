# flag leak
## Step 1



We were provided with a 32-bit ELF binary. The first step was to analyze its protections using checksec. Here’s what I discovered:

NX Enabled: This means the stack is non-executable, so shellcode injection won’t work.

Other protections (e.g., PIE, canaries, RELRO) were disabled.

Running the binary revealed that it accepts user input and simply echoes it back.

Diving Deeper with Ghidra

Opening the binary in Ghidra provided clarity, as the binary was not stripped. A quick analysis of the vuln() function revealed a format string vulnerability in a printf() call. This vulnerability allows us to leak stack contents using format specifiers such as %p.

The readflag() function was also notable. It stores the flag in a local variable called local_4c within the vuln() function. This hinted that the flag could be leaked from the stack using the format string vulnerability.

## Step 2
Locating the Flag

Disassembling with objdump

To assist with debugging, I used objdump to disassemble the binary and identified two crucial addresses:

Return address of vuln(): 0x8049418

Instruction before printf() in vuln(): 0x80493a3

These addresses helped guide my exploration in GDB.

Analyzing the Stack in GDB

Using GDB, I set a breakpoint at 0x80493a3 (break *0x80493a3) and examined the stack with x/70x $esp.

From the top of the stack (top-left), I searched for the return address (0x8049418). By counting the positions from top to bottom, left to right, I determined that the return address was located 55 positions relative to the top of the stack.

To verify this, I ran the program and entered %55$p. The output confirmed the return address, validating my calculation.

Finding the Flag

With the return address identified, I examined the stack between the return address and the top. Converting the hexadecimal values to ASCII helped me locate the flag. It was approximately 36 positions from the top of the stack.

Retrieving the Flag

The final payload to leak the flag was:

%36$p%37$p%38$p%39$p%40$p%41$p%42$p%43$p%44$p%45$p%46$p%48$p%49$p

After running the program with this input and converting the hexadecimal output to ASCII, I successfully retrieved the flag.

## What I Leaearned

Format String Vulnerabilitie

Stack Inspection: .

Hex to ASCII Conversion:

Understanding Binary Protections:

## other methods
none
## refernces
https://medium.com/@0xwan/picoctf-2022-flag-leak-writeup-binary-exploitation-8d5194fb36f0
